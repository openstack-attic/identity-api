OpenStack Identity API v3 OS-IDP Extension
==========================================

Provide the ability for users to manage Identity Providers (IdPs). This
extension requires v3.0+ of the Identity API.

Definitions
-----------

- *Trusted Identity Provider:* An identity provider setup within the Identity
  Service API that is trusted to provide authenticated user information.
- *Service Provider:* A system entity that provides services to principals or
  other system entities, in this case, the OpenStack Identity Service API is
  the Service Provider.

API Resources
-------------

### Identity Providers: `/OS-IDP/identity_providers`

An Identity Provider is a third party service that is trusted by the Identity
Service to authenticate identities. For OpenStack, the ID of the identity
provider is the key. Each IdP the `protocol_data` field can be used to add IdP
specific metadata that is needed to talk to this IdP.

Attributes:

- `description` (string)
- `enabled` (boolean)
- `name` (string)

### Public Keys: `/OS-IDP/identity_providers/{idp_id}/public_keys`

Public keys are used to validate incoming IdP requests. An IdP may have
multiple registered public keys.

Attributes:

- `key` (string)

### Protocols: `/OS-IDP/identity_providers/{idp_id}/protocols`

A protocol entry contains information that dictates which mapping rules
to use for a given incoming request. An IdP may have multiple supported
protocols.

Attributes:

- `OS-MAP:mapping_id` (string)

Identity Provider API
---------------------

### Register an Identity Provider: `POST /OS-IDP/identity_providers`

Request:

    {
        "identity_provider": {
            "description": "Stores ACME identities.",
            "enabled": true,
            "name": "acme_idp"
        }
    }


Response:

    Status: 201 Created

    {
        "identity_provider": {
            "description": "Stores ACME identities",
            "enabled": true,
            "id": "7fea2d",
            "links": {
                "protocols": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/protocols",
                "public_keys": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/public_keys",
                "self": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d"
            },
            "name": "acme_idp"
        }
    }

### List identity providers: `GET /OS-IDP/identity_providers`

Response:

    Status: 200 OK

    {
        "identity_providers": [
            {
                "description": "Stores ACME identities",
                "enabled": true,
                "id": "0c2a74",
                "links": {
                    "protocols": "http://identity:35357/v3/OS-IDP/identity_providers/0c2a74/protocols",
                    "public_keys": "http://identity:35357/v3/OS-IDP/identity_providers/0c2a74/public_keys",
                    "self": "http://identity:35357/v3/OS-IDP/identity_providers/0c2a74"
                },
                "name": "acme_idp"
            },
            {
                "description": "Stores contractor identities",
                "enabled": false,
                "id": "7fea2d",
                "links": {
                    "protocols": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/protocols",
                    "public_keys": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/public_keys",
                    "self": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d"
                },
                "name": "beta_idp"
            }
        ],
        "links": {
            "next": null,
            "previous": null,
            "self": "http://identity:35357/v3/OS-IDP/identity_providers"
        }
    }

### Get Identity provider: `GET /OS-IDP/identity_providers/{idp_id}`

Response:

    Status: 200 OK

    {
        "identity_provider": {
            "description": "Stores ACME identities",
            "enabled": false,
            "id": "7fea2d",
            "links": {
                "protocols": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/protocols",
                "public_keys": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/public_keys",
                "self": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d"
            },
            "name": "beta_idp"
        }
    }

### Delete identity provider: `DELETE /OS-IDP/identity_providers/{idp_id}`

When an identity provider is deleted, any tokens generated by that identity
provider will be revoked.

Response:

    Status: 204 No Content

### Update identity provider: `PATCH /OS-IDP/identity_providers/{idp_id}`

Request:

    {
        "identity_provider": {
            "enabled": true
        }
    }

Response:

    Status: 200 OK

    {
        "identity_provider": {
            "description": "Beta dev idp",
            "enabled": true,
            "id": "7fea2d",
            "links": {
                "protocols": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/protocols",
                "public_keys": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/public_keys",
                "self": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d"
            },
            "name": "beta_idp"
        }
    }

When an identity provider is disabled, any tokens generated by that identity
provider will be revoked.

### Add public key to an identity provider: `PUT /OS-IDP/identity_providers/{idp_id}/public_keys`

Request:

    {
        "public_key": {
            "key": "mQCNAi+UeBsAAAEEA== =ddBN”
        }
    }

Response:

    Status: 201 Created

    {
        "public_key": {
            "id": "5adddb",
            "links": {
                "identity_provider": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d",
                "self": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/public_keys/5adddb"
            },
            "key": "mQCNAi+UeBsAAAEEA== =ddBN”
        }
    }

### List public keys of an identity provider: `GET /OS-IDP/identity_providers/{idp_id}/public_keys`

Response:

    Status: 200 OK

    {
        "public_keys": [
            {
                "id": "5adddb",
                "links": {
                    "identity_provider": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d",
                    "self": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/public_keys/5adddb"
                },
                "key": "mQCNAi+UeBsAAAEEA== =ddBN”
            },
            {
                "id": "3af5bf",
                "links": {
                    "identity_provider": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d",
                    "self": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/public_keys/3af5bf"
                },
                "key": "mQCNAi+UeBsAAAEEA== =ddBN”
            }
        ],
        "links": {
            "self": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/public_keys",
            "previous": null,
            "next": null
        }
    }

### Get public key from an identity provider: `GET /OS-IDP/identity_providers/{idp_id}/public_keys/{key_id}`

Response:

    Status: 200 OK

    {
        "public_key": {
            "id": "5adddb",
            "links": {
                "identity_provider": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d",
                "self": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/public_keys/5adddb"
            },
            "key": "mQCNAi+UeBsAAAEEA== =ddBN”
        }
    }

### Delete public key for identity provider: `DELETE /OS-IDP/identity_providers/{idp_id}/public_keys/{key_id}`

Response:

    Status: 204 No Content

### Add a supported protocol to an identity provider: `PUT /OS-IDP/identity_providers/{idp_id}/protocols`

Request:

    {
        "protocol": {
            "OS-MAP:mapping_id": "xyz234"
        }
    }

Response:

    Status: 200 OK

     {
        "protocol": {
            "id": "saml2",
            "OS-MAP:mapping_id": "xyz234",
            "links": {
                "identity_provider": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d",
                "self": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/protocols/saml2"
            }
        }
    }

### List all supported protocols of an identity provider: `GET /OS-IDP/identity_providers/{idp_id}/protocols`

Response:

    Status: 200 OK

    {
        "links": {
            "next": null,
            "previous": null,
            "self": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/protocols"
        },
        "protocols": [
            {
                "id": "saml2",
                "links": {
                    "identity_provider": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d",
                    "self": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/protocols/saml2"
                },
                "OS-MAP:mapping_id": "xyz234"
            }
        ]
    }

### Get a supported protocol to an identity provider: `GET /OS-IDP/identity_providers/{idp_id}/protocols/{protocol_id}`

Response:

    Status: 200 OK

     {
        "protocol": {
            "id": "saml2",
            "mapping_id": "xyz234",
            "links": {
                "identity_provider": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d",
                "self": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/protocols/saml2"
            }
        }
    }

### Update a supported protocol to an identity provider: `PATCH /OS-IDP/identity_providers/{idp_id}/protocols/{protocol_id}`

Request:

    {
        "protocol": {
            "OS-MAP:mapping_id": "xyz234"
        }
    }

Response:

    Status: 200 OK

     {
        "protocol": {
            "id": "saml2",
            "OS-MAP:mapping_id": "xyz234",
            "links": {
                "identity_provider": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d",
                "self": "http://identity:35357/v3/OS-IDP/identity_providers/7fea2d/protocols/saml2"
            }
        }
    }

### Delete a supported protocol to an identity provider: `DELETE /OS-IDP/identity_providers/{idp_id}/protocols/{protocol_id}`

Response:

    Status: 204 No Content
