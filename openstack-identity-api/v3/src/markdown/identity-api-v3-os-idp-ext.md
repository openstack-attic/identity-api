OpenStack Identity API v3 OS-IDP Extension
==========================================

Provide the ability for users to manage identity providers. This
extension requires v3.0+ of the Identity API.

Definitions
-----------

- *Trusted Identity Provider:* An identity provider setup within the
  Identity Service that is trusted to provide authenticated user information
  for token generation.

API Resources
-------------

### Identity Providers: `/OS-IDP/identity_providers`

An `identity provider` is a third party service that is trusted by the
Identity Service to authenticate identities. For OpenStack, the ID of
the identity provider is the key. Each IDP the protocol_data field
can be used to add IDP specific metadata that is needed to talk to
this IDP.

Optional attributes:

- `description` (string)
- `protocols` (list)
- `public_keys` (list)

Immutable attributes:

- `name` (string)
- `active` (boolean)
- `domain_id` (string)

Identity Provider API
---------------------

### Create an Identity Provider: `POST /OS-IDP/identity_providers`

Request:

    {
        “name” :  “acme_idp”,
        “description” :  “Stores ACME identities.”,
        “active” : true,
        “domain_id” : “12345”
    }


Response:

    Status: 201 Created

    {
        "identity-provider": {
            "name": "acme_idp",
            "active": true,
            "description": "Stores ACME identities",
            "id": "7fea2d",
            "links": {
                "self": "http:/identity:35357/v3/OS-IDP/identity_providers/7fea2d"
            }
        }
    }

### List identity providers: `GET /OS-IDP/identity_providers`

Response:

    Status: 200 OK

    {
        "identity_providers": [
            {
                "id": "0c2a74",
                "name": "acme_idp",
                "active": true,
                “protocols” : ['saml2'],
                "public_keys": ['3af5bf'],
                "description": "Stores ACME identities",
                "links": {
                    "self": "http:/identity:35357/v3/OS-IDP/identity_providers/0c2a74"
                }
            },
            {
                "id": "7fea2d",
                "description": "Beta dev idp",
                "name": "beta_idp",
                “protocols” : ['saml2'],
                "public_keys": ['3af5bf'],
                "active": false,
                "links": {
                    "self": "http:/identity:35357/v3/OS-IDP/identity_providers/7fea2d"
                }
            }
        ],
        "links": {
            "next": null,
            "previous": null,
            "self": "http:/identity:35357/v3/OS-IDP/identity_providers"
        }
    }

### Get Identity provider: `GET /OS-IDP/identity_providers/{idp_id}`

Response:

    Status: 200 OK

    {
        "identity-provider": {
            "id": "7fea2d",
            "description": "Beta dev idp",
            "name": "beta_idp",
            “protocols” : ['saml2'],
            "public_keys": ['3af5bf'],
            "active": false,
            "links": {
                "self": "http:/identity:35357/v3/OS-IDP/identity_providers/7fea2d"
            }
        }
    }

### Delete identity provider: `DELETE /OS-IDP/identity_providers/{idp_id}`

When an identity provider is deleted, any tokens generated by that identity
provider will be revoked.

Response:

    Status: 204 No Content

### Update identity provider: `PATCH /OS-IDP/identity_providers/{idp_id}`

Only a identity providers `description`, `name`, `active` and
`protocols` are mutable. Attempting to PATCH an immutable attribute
should result in a HTTP 400 Bad Request.

Request:

    {
        "identity-provider": {
            "active": true
        }
    }

Response:

    Status: 200 OK

    {
        "identity-provider": {
            "description": "Beta dev idp",
            "name": "beta_idp",
            “protocols”: ['saml2'],
            "public_keys": ['3af5bf'],
            "active": true,
            "id": "7fea2d",
            "links": {
                "self": "http:/identity:35357/v3/OS-OAUTH1/consumers/7fea2d",
            }
        }
    }

When an identity provider is made inactive, any tokens generated by that identity
provider will be revoked.


Identity Provider - Public Key API
----------------------------------

### Add public key to an identity provider: `PUT /OS-IDP/identity_providers/{idp_id}/public_keys`

Request:

    {
        "public_key": {
            "key": "--key-id--"
        }
    }

Response:

    Status: 201 Created

    {
        "public_key": {
            "id": "5adddb",
            "links": {
                "self": "http:/identity:35357/v3/OS-IDP/identity_providers/7fea2d/public_keys/5adddb"
            },
            "key": "--key-id--"
        }
    }

### List public keys of an identity provider: `GET /OS-IDP/identity_providers/{idp_id}/public_keys`

Response:

    Status: 200 OK

    {
        "public_keys": [
            {
                "id": "5adddb",
                "links": {
                    "self": "http:/identity:35357/v3/OS-IDP/identity_providers/7fea2d/public_keys/5adddb"
                },
                "key": "--key-id--"
            },
            {
                "id": "3af5bf",
                "links": {
                    "self": "http:/identity:35357/v3/OS-IDP/identity_providers/7fea2d/public_keys/3af5bf"
                },
                "key": "--key-id--"
            }
        ],
        "links": {
            "self": "self": "http:/identity:35357/v3/OS-IDP/identity_providers/7fea2d/public_keys",
            "previous": null,
            "next": null
        }
    }

### Get public key from an identity provider: `GET /OS-IDP/identity_providers/{idp_id}/public_keys/{key_id}`

Response:

    Status: 200 OK

    {
        "public_key": {
            "id": "5adddb",
            "links": {
                "self": "http:/identity:35357/v3/OS-IDP/identity_providers/7fea2d/public_keys/5adddb"
            },
            "key": "--key-id--"
        }
    }

### Delete public key for identity provider: `DELETE /OS-IDP/identity_providers/{idp_id}/public_keys/{key_id}`

Response:

    Status: 204 No Content


Identity Provider - Protocol API
--------------------------------

### Add protocol support to an identity provider: `PUT /OS-IDP/identity_providers/{idp_id}/protocols`

Request:

    {
        "protocol": {
            "name": "saml2"
        }
    }

Response:

    Status: 201 Created

    {
        "protocol": {
            "id": "3489a1",
            "links": {
                "self": "http:/identity:35357/v3/OS-IDP/identity_providers/7fea2d/protocols/3489a1"
            },
            "name": "saml2"
        }
    }

### List supported protocols of an identity provider: `GET /OS-IDP/identity_providers/{idp_id}/protocols`

Response:

    Status: 200 OK

    {
        "protocols": [
            {
                "id": "3489a1",
                "links": {
                    "self": "http:/identity:35357/v3/OS-IDP/identity_providers/7fea2d/protocols/3489a1"
                },
                "name": "saml2"
            },
            {
                "id": "84cfe4",
                "links": {
                    "self": "http:/identity:35357/v3/OS-IDP/identity_providers/7fea2d/protocols/84cfe4"
                },
                "name": "openId"
            }
        ],
        "links": {
            "self": "self": "http:/identity:35357/v3/OS-IDP/identity_providers/7fea2d/protocols",
            "previous": null,
            "next": null
        }
    }

### Get protocol support from an identity provider: `PUT /OS-IDP/identity_providers/{idp_id}/protocols/{protocol_id}`

Response:

    Status: 200 OK

    {
        "protocol": {
            "id": "84cfe4",
            "links": {
                "self": "http:/identity:35357/v3/OS-IDP/identity_providers/7fea2d/protocols/84cfe4"
            },
            "name": "openId"
        }
    }

### Delete protocol support from an identity provider: `DELETE /OS-IDP/identity_providers/{idp_id}/protocols/{protocol_id}

Response:

    Status: 204 No Content
